name: "Test env"
on:
  - workflow_dispatch
  - push

jobs:
  github:
    timeout-minutes: 30
    runs-on: ubuntu-latest
    environment:
      name: dev
    env:
      TEST_VAR: job env
    permissions:
      contents: write
  
    steps:
      - name: "Checkout"
        uses: actions/checkout@v3
      - name: "GitHub CLI Setup"
        uses: sersoft-gmbh/setup-gh-cli-action@v2
        with:
          version: stable
      - name: "GitHub create Release"
        if: 0
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          VERSION=1.0.0
          
          gh release create "${VERSION}" -t "${VERSION}" --generate-notes --verify-tag

      - name: "GitHub update Release"
        if: 1
        env:
          GH_TOKEN: ${{ secrets.GIT_HUB_API_TOKEN }}
        run: |
          VERSION=1.0.0
          
          gh release edit "${VERSION}" --draft=true --prerelease=false
      - name: "Check rate limit"
        env:
          GH_TOKEN: ${{ secrets.GIT_HUB_API_TOKEN }}
        run: |
          gh api \
          -H "Accept: application/vnd.github+json" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          /rate_limit